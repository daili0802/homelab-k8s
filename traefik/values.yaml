# Traefik Configuration
# Version: v3.6.1

# Global settings
globalArguments: []

# Additional arguments
additionalArguments:
  - "--api.dashboard=true"
  - "--api.insecure=false"
  - "--log.level=INFO"
  - "--accesslog=true"
  - "--providers.kubernetescrd.allowCrossNamespace=true"
  - "--providers.kubernetescrd.allowExternalNameServices=true"
  - "--providers.kubernetesingress.allowExternalNameServices=true"

# Deployment configuration
deployment:
  enabled: true
  replicas: 3
  
  # Pod anti-affinity to spread across nodes
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8082"
  
# Ports configuration
ports:
  web:
    port: 80
    exposedPort: 80
    protocol: TCP
  websecure:
    port: 443
    exposedPort: 443
    protocol: TCP
    # Enable HTTP/3
    http3:
      enabled: true
  traefik:
    port: 8000
    expose:
      default: false
    exposedPort: 8000
    protocol: TCP
  metrics:
    port: 8082
    expose:
      default: true
    exposedPort: 8082
    protocol: TCP

# Service configuration
service:
  enabled: true
  type: LoadBalancer
  
  # MetalLB will assign 192.168.2.100
  annotations:
    metallb.universe.tf/address-pool: default-pool
  
  # Request specific IP (optional, MetalLB will auto-assign from pool)
  # loadBalancerIP: "192.168.2.100"

# Providers configuration
providers:
  kubernetesCRD:
    enabled: true
    allowCrossNamespace: true
    allowExternalNameServices: true
  
  kubernetesIngress:
    enabled: true
    allowExternalNameServices: true
    publishedService:
      enabled: true
  
  kubernetesGateway:
    enabled: true

# IngressRoute for dashboard
ingressRoute:
  dashboard:
    enabled: true
    # Accessible at: https://traefik.lab.arpa/dashboard/
    matchRule: Host(`traefik.lab.arpa`) && (PathPrefix(`/dashboard`) || PathPrefix(`/api`))
    entryPoints: ["websecure"]
    # Note: TLS configuration will be added after cert-manager setup

# Resource limits
resources:
  requests:
    cpu: "100m"
    memory: "50Mi"
  limits:
    cpu: "1000m"
    memory: "300Mi"

# Pod anti-affinity
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - traefik
        topologyKey: kubernetes.io/hostname

# Logs
logs:
  general:
    level: INFO
  access:
    enabled: true
    filters: {}

# Metrics
metrics:
  prometheus:
    enabled: true
    addEntryPointsLabels: true
    addRoutersLabels: true
    addServicesLabels: true

# Security headers (can customize later)
# Will apply to dashboard
securityContext:
  capabilities:
    drop: [ALL]
    add: [NET_BIND_SERVICE]
  readOnlyRootFilesystem: true
  runAsGroup: 65532
  runAsNonRoot: true
  runAsUser: 65532

# Persistence for ACME certificates (if using Let's Encrypt in future)
persistence:
  enabled: false  # Enable when adding cert-manager
  # name: acme-storage
  # accessMode: ReadWriteOnce
  # size: 128Mi
  # path: /data
